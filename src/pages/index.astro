---
import Layout from '../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from "astro:content";


const allIssues = await getCollection("issues")
	.then((issues) => issues.sort((a, b) => {
		return Number(b.data.number) - Number(a.data.number);
	}))
	.catch((err) => {
		console.error(err);
		return [];
	});

const issuesByYear = allIssues.reduce<Record<string, CollectionEntry<'issues'>[]>>((acc, issue) => {
	const year = issue.data.year;
	if (!acc[year]) {
		acc[year] = [];
	}
	acc[year].push(issue);
	return acc;
}, {});

---

<Layout>
	<section>
		<div class="container editorial">
			<div class="editorial__content">
				<p>A Design Magazine Brasil foi uma revista brasileira que falava não apenas sobre as várias áreas do
					design, mas também sobre áreas tangentes, como arquitetura, arte e tecnologia.</p>
				<p>Tinhamos como objetivo trazer conteúdo de qualidade e de forma acessível. Enquanto esteve no ar ela
					contou com diversos colaboradores e parceiros que ajudaram nessa missão. Espero que tenhamos ajudado
					estudantes e profissionais durante esse tempo.</p>
				<p>Foi um prazer fazer parte dessa jornada com todos vocês.</p>
			</div>
			<div class="editorial__name">
				Lucas Fernandes, Diretor
			</div>
		</div>
	</section>
	<section>
		<div class="container">
			<h2>Edicões Publicadas</h2>
			<ul>
				{Object.keys(issuesByYear).sort((a, b) => Number(b) - Number(a)).map((year) => (
					<li>
						<h3>{year}</h3>
						<ul>
							{issuesByYear[year].map((issue) => (
								<li>
									<a href={`/issues/${issue.data.number}/`}>
										Edição {issue.data.number} - {issue.data.title}
									</a>
								</li>
							))}
						</ul>
					</li>
				))}
			</ul>
		</div>
	</section>
</Layout>

<style>
	.editorial {
		font-size: 1.5rem;
		margin-bottom: 2rem;
		max-width: 64ch;
		text-wrap: pretty;
		position: relative;

		&::before{
			content: "“";
			position: absolute;
			font-size: 16rem;
			opacity: 0.1;
			top: -6rem;
			left: -3rem;
			font-family: 'Crimson Pro', serif;
		}
	}

	.editorial__content {
		margin-bottom: 1.5rem;
	}

	.editorial__name {
		text-align: right;

		&::before {
			content: "― ";
		}
	}
	
</style>